<project name="reporting-jsp" default="war">
	<property name="dist" value="dist"/>
	<property name="lib" value="lib"/>
    <property name="src" value="src"/>
    <property name="classes" value="classes"/>
    <property name="test" value="test"/>
    <property name="test.results" value="testresults"/>

	<target name="clean">
		<mkdir dir="${dist}"/>
        <mkdir dir="${classes}"/>
        <mkdir dir="${test.results}"/>
		<delete dir="${dist}"/>
        <delete dir="${classes}"/>
        <delete dir="${test.results}"/>
	</target>

    <target name="init" depends="clean">
        <mkdir dir="${dist}"/>
        <mkdir dir="${classes}"/>
        <mkdir dir="${test.results}"/>
    </target>

    <target name="compile" depends="init">
        <javac srcdir="${src}" destdir="${classes}" debug="true">
            <classpath>
                <pathelement location="${lib}/servlet.jar"/>
                <pathelement location="${lib}/xalan.jar"/>
            </classpath>
        </javac>
    </target>

    <target name="test" depends="compile" description="Executes the unit tests">
        <javac srcdir="${test}" destdir="${classes}">
            <classpath>
                <pathelement location="${lib}/servlet.jar"/>
                <pathelement location="${lib}/xalan.jar"/>
                <pathelement location="${lib}/junit.jar"/>
            </classpath>
        </javac>
        <junit fork="yes" haltonfailure="yes" >
            <classpath >
                <pathelement location="${lib}/servlet.jar"/>
                <pathelement location="${lib}/xalan.jar"/>
                <pathelement location="${lib}/junit.jar"/>
                <pathelement location="${classes}"/>
            </classpath>
            <formatter type="plain" usefile="false" />
            <formatter type="xml" />
            <batchtest todir="${test.results}" >
                <fileset dir="${classes}" includes="**/*Test.class" />
            </batchtest>
        </junit>
    </target>

	<target name="war" depends="test">
		<war warfile="${dist}/cruisecontrol.war" webxml="WEB-INF/web.xml">
			<fileset dir=".">
				<exclude name="${dist}/"/>
				<exclude name="WEB-INF/web.xml"/>
				<exclude name="src/"/>
				<exclude name="test/"/>
				<exclude name="${lib}/"/>
                <exclude name="${classes}/"/>
			</fileset>
			<lib dir="${lib}">
				<include name="xalan.jar"/>
				<include name="xerces.jar"/>
			</lib>
            <classes dir="${classes}"/>
		</war>
	</target>

</project>