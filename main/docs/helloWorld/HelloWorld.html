<!doctype html public "-//w3c//dtd html 3.2//en">

<html>

<head>
<title>CruiseControl Hello World</title>
<meta name="GENERATOR" content="Arachnophilia 4.0">
<meta name="FORMATTER" content="Arachnophilia 4.0">
</head>

<body bgcolor="#CCCCFF" text="#000066" link="#0000ff" vlink="#800080" alink="#ff0000">
<h1><center>CruiseControl Hello World</center></h1>
<center>By Jason Che-han Yip, <a href="mailto:jcyip@thoughtworks.com">jcyip@thoughtworks.com</a></center>
<center><b>Last modified:</b> June 19, 2001</center>
<hr width="95%" align=center>

<p>This is a very simple sample use of CruiseControl on a Hello World project using Tomcat as the servlet engine.  The zipped source is available here: <a href="ccHelloWorld.zip">[Zipped Source]</a>  Please e-mail if you have any comments, corrections, or problems.</p>

<ol>
	<li> <b><a href="#buildXML">Set up the Ant build.xml</a></b>
	<li> <b><a href="#ccProperties">Set up cruisecontrol.properties</a></b>
	<li> <b><a href="#setupTomcat">Set up Tomcat</a></b>
	<li> <b><a href="#runCC">Run Cruise Control</a></b>
	<li> <b><a href="#viewServlet">View servlet</a></b>
</ol>

<h2><a name="buildXML">Set up the Ant build.xml</a></h2>
<p><b>NOTE:</b> If you don't have Jikes, switch the build.compiler property to "modern" (JDK 1.3) or "classic".</p>
<p><b>WARNING:</b> javac is not releasing locks on jars so jikes is recommended.

<p>I'm assuming that you are already familiar with Ant build scripts so I will only point out the key modifications that must be made to prepare the build script for CruiseControl.  For convenience of modification, the properties are set at the top of the build.xml and referenced in the targets below.  The only CruiseControl specific property is "masterbuild.logdir".  This property should be the relative path to where you want CruiseControl to store its logs.</p>  

<p><b>NOTE:</b> This log directory must be duplicated in the <a href="#setupTomcat">web.xml for Tomcat.</a></p>

<p>The three CruiseControl-specific targets are "modificationset", "masterbuild", and "cleanbuild":</p>
<ul>
	<li> <b>modificationset:</b> More details on modificationset can be found in the <a href="../manual/anttasks.html">Ant Task manual</a>.  The "lastGoodBuildTime" property will be generated by CruiseControl. 

<p><b>NOTE: </b> modificationset.file is set by the ModificationSet class and is not required by the modificationset task</p>

	<li> <b>masterbuild:</b> This is the target that should be specified in <a href="#ccProperties">cruisecontrol.properties</a> for "target".  Pay close attention to the order of the depends.  If modificationset does not detect any changes, the build will not continue.
	<li> <b>cleanbuild:</b> This is the target that should be specified in <a href="#ccProperties">cruisecontrol.properties</a> for "cleantarget".
</ul>

<h2><a name="ccProperties">Set up cruisecontrol.properties</a></h2>
<p>Most of the properties are straightforward from the inline comments.  Here are a few to be wary of:</p>

<ul>
 	<li> <b>logDir:</b> Should be the same as the "masterbuild.logdir" Ant property set in this example's build.xml
	<li> <b>currentBuildStatusFile:</b> This file will be generated by CruiseControl.
</ul>

<h2><a name="setupTomcat">Set up Tomcat</a></h2>
<p>First, you need to modify web.xml.  Again most values are self-explanatory:</p>

<ul>
	<li> <b>logDir:</b> Must be the absolute path to the logDir specified in <a href="#ccProperties">cruisecontrol.properties</a> and the "masterbuild.logdir" Ant property in <a href="#buildXML">build.xml</a>
	<li><b>xslFile:</b>  Must be the absolute path to cruisecontrol.xsl
	<li><b>currentBuildStatusFile:</b> The logdir will be prepended to the specified file to find the current build status file.
</ul>

<p>Copy the buildservlet.war to Tomcat's webapps directory.  The buildservlet.war is in the dist directory of CruiseControl.  Start Tomcat using bin/startup.bat or bin/startup.sh</p>

<h2><a name="runCC">Run CruiseControl</a></h2>
<p>Use the provided cruiseControl.bat or cruiseControl.sh to run CruiseControl.  You'll need to set CCDIR as appropriate.  Arguments are:</p>

<ul>
	<li> <b>-lastbuild YYYYMMDDHHmmss</b> , <i>Example:</i> For a last build at Jan. 1, 2001 at 12:00:00, -lastbuild 20010101120000
	<li> <b>-label string.integer</b> , <i>Example:</i> -label test.0
	<li> <b>-properties propertiesFiles</b> , <i>Example:</i> -properties cruisecontrol.properties
</ul>

<p><b>NOTE:</b> lastbuild and label are only required the first time CruiseControl is run.  properties will default to cruisecontrol.properties if not specified</p>

<h2><a name="viewServlet">View Servlet</a></h2>
<p>If the CruiseControl setup was successful, you should have received an e-mail with a link to a page that will be generated by the servlet.</p>

<p><b>NOTE:</b> Generated log data is stored in modificationset.xml and aggregated test results in test-results.xml.  Formatting is controlled by cruisecontrol.xsl.</p>

</body>

</html>

