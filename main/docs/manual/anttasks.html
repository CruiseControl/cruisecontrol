<html>
<head>
    <title>CruiseControl Ant Tasks User Manual</title>
</head>

<body>

<h1>CruiseControl Ant Tasks User Manual</h1>
<p>by</p>
<!-- Names are in alphabetical order, on last name -->
<ul>
  <li>Alden Almagro (<a href="mailto:alden@thoughtworks.com">alden@thoughtworks.com</a>)</li>
  <li>Paul Julius (<a href="mailto:pdjulius@thoughtworks.com">pdjulius@thoughtworks.com</a>)</li>
  <li>Jason Yip (<a href="mailto:jcyip@thoughtworks.com">jcyip@thoughtworks.com</a>)</li>
  <li>Niclas Olofsson</li>
  <li>Eli Tucker</li>
</ul>

<p>Version 1.17 - 07/28/2001</p>
<hr>
<h2>Table of Contents</h2>
<ul>
  <li><a href="#modificationset">ModificationSet</a></li>
  <ul>
	  <li><a href="#clearcaseelement">ClearCaseElement</a></li>
	  <li><a href="#cvselement">CvsElement</a></li>
	  <li><a href="#p4element">P4Element</a></li>
	  <li><a href="#starteamelement">StarTeamElement</a></li>
	  <li><a href="#vsselement">VssElement</a></li>
        <li><a href="#vssjournalelement">VssJournalElement</a></li>
  </ul>
  <li><a href="#starteamcheckout">StarTeamCheckout</a></li>
  <li><a href="#starteamlabel">StarTeamLabel</a></li>
</ul>


<h2><a name="modificationset">ModificationSet</a></h2>

<h3>Description</h3>

<p>
Controls a build process by terminating a build if no modifications have been
made. This element must include subelements designed to provide a list of
modifications, such as CVSElement.
</p>
<p>
To use this task in an Ant build script the following line will need to be included so that Ant will
know where to find the task:
<pre>
   &lt;taskdef name="modificationset" classname="net.sourceforge.cruisecontrol.ModificationSet" /&gt;
</pre>
</p>

<h4>Parameters</h4>

<table border="1" cellspacing="0" cellpadding="0">
    <tr>
        <td valign="top"><b>Attribute</b></td>
        <td valign="top"><b>Description</b></td>
        <td valign="top"><b>Required</b></td>
    </tr>

    <tr>
        <td valign="top">lastbuild</td>
        <td valign="top">The time the last build occured. When used in conjuction with
        the MasterBuild class this should be set to the property   <code>${lastGoodBuildTime}</code></td>
        <td valign="top">Yes</td>
    </tr>

    <tr>
        <td valign="top">quietperiod</td>
        <td valign="top">The number of seconds that must expire after the last
        repository change before a build will commence. Set this value to allow
        developers enough time to commit all their changes to the repository. This stops
        a build from commencing while a developer is in the middle of their commit
        process.</td>

        <td valign="top">Yes</td>
    </tr>

    <tr>
        <td valign="top">dateformat</td>
        <td valign="top">Date formatting pattern which conforms to those recognized by
            <A HREF='http://java.sun.com/j2se/1.3/docs/api/java/text/SimpleDateFormat.html'><CODE>java.text.SimpleDateFormat</CODE></A>.
            If none is provided, then the default date format will be used,
            <CODE>MM-dd-yyyy HH:mm:ss</CODE>. Dates will be displayed in the timezone
            of the current Locale.</td>

        <td valign="top">No</td>
    </tr>
</table>

<h3>Vendor-specific source control elements</h3>

Each vendor-specific nested element controls the interface specifc to its source-control tool.

<a name="clearcaseelement"></a>
<h3>ClearCaseElement</h3>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">viewpath</td>
    <td valign="top">Local working copy to use when making queries</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">branch</td>
        <td valign="top"></td>
    <td valign="top" align="center">no</td>
  </tr>
  <tr>
    <td valign="top">recursive</td>
        <td valign="top">"true" or "false"</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

<a name="cvselement"></a>
<h3>CvsElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process.</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">cvsroot</td>
    <td valign="top">The CVSROOT required to communicate with the CVS repository.  Defaults to assume CVSROOT has been set in the environment.</td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
    <td valign="top">localworkingcopy</td>
        <td valign="top">This should be the path to the root of the CVS project client copy (i.e., the local working copy).  Defaults to current directory.  Under Linux, Java does not execute cvs log with no local working copy correctly.  This despite the command working fine in a command shell.  Therefore, you must specify the localworkingcopy under Linux (e.g., "." for the current directory) <b>NOTE:</b> CVS under Unix does not support absolute file paths</td>
    <td valign="top" align="center">No (Win32), Yes (Linux)</td>
  </tr>
  <tr>
    <td valign="top">tag</td>
    <td valign="top">The target CVS tag.  This is used for branches.  If missing, the HEAD branch is assumed.</td>
    <td valign="top" align="center">No</td>
  </tr>
</table>

<h4>Example</h4>
<PRE>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset lastbuild=&quot;${lastGoodBuildTime}&quot;
        quietperiod=&quot;30&quot;
        dateformat=&quot;yyyy-MMM-dd HH:mm:ss&quot;&gt;

        &lt;cvselement cvsroot=&quot;:pserver:anoncvs@jakarta.apache.org:/home/cvspublic&quot;
            localworkingcopy=&quot;src\mymodule&quot;/&gt;
    &lt;/modificationset&gt;
&lt;/target&gt;
</PRE>

<a name="p4element"></a>
<h3>P4Element</h3>

<p>Returns a list of modifications found in the depot between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process.</p>
<p>Requires additional libraries to run.
<ul>
    <li>ORO 2.0 regexp package from Apache.
    <li>Ant's optional package containing P4 tasks.
</ul>
Because of this, the P4Element is distributed in it's own package.
</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
    <td align="center" valign="top"><b>Example</b></td>
  </tr>
  <tr>
    <td valign="top">port</td>
    <td valign="top">The p4d server and port to connect to.</td>
    <td valign="top" align="center">Yes</td>
    <td valign="top">perforce:1666</td>
  </tr>
  <tr>
    <td valign="top">user</td>
    <td valign="top">The p4 username.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">client</td>
    <td valign="top">The p4 client spec to use.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">view</td>
    <td valign="top">The client, branch or label view to operate upon. See the p4 user guide for more info.</td>
    <td valign="top" align="center">Yes</td>
    <td valign="top">//depot/project/...</td>
  </tr>
</table>
<h4>Example</h4>
<pre>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset ...

        ...

        &lt;p4element port=&quot;perforce:1666&quot;
            user=&quot;non&quot;
            client=&quot;myclient&quot;
            view=&quot;//depot/test...&quot;/&gt;

        ...

    &lt;/modificationset&gt;
&lt;/target&gt;
</pre>
<h4>Futures</h4>
<p>
<ul>
    <li>Use project set/get property to set attributes.
    <li>Verify that several P4Elements can be specified (should work).
    <li>Unit-tests.
</ul>
</p>

<a name="starteamelement"></a>
<h3>StarTeamElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process.  NOTE: this
task requires a proprietary 3rd party library that is not currently distributed with Cruise Control.
</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">folder</td>
    <td valign="top">The StarTeam folder to recursively scan for modifications.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">starteamurl</td>
        <td valign="top">The url to the StarTeam server in the form "servername:portnum/project/view"</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">username</td>
    <td valign="top">The username to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">password</td>
    <td valign="top">The password to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

<a name="vsselement"></a>
<h3>VssElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process. The two
property attributes are meant to provide the rest of the ant script with a means to conditionally
build targets based on what was actually modified.  See the examples below for more detail.  I've
found that it's quicker to log if a delete has occurred within vsselement, clean out all the source
using Ant, and reget all the source rather than using sourcesafe to try to sync itself up with the
local drive.  That's the rationale behind having the propertyondelete attribute.

</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">ssdir</td>
    <td valign="top">The sourcesafe directory that you would like to recursively scan for
    modifications.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
      <td valign="top">login</td>
          <td valign="top">login,password for sourcesafe.</td>
      <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">property</td>
        <td valign="top">Set the given property to "true" if any modifications have occurred within
        this sourcesafe folder or any child folders recursively.</td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
      <td valign="top">propertyondelete</td>
          <td valign="top">Set the given property to "true" if any deletes have occurred within
        this sourcesafe folder or any child folders recursively.</td>
      <td valign="top" align="center">No</td>
  </tr>
  <tr>
      <td valign="top">dateformat</td>
      <td valign="top">Uses the given date format rather than the default for querying SourceSafe 
         and parsing SourceSafe's history results.  This should be in the form
         "MM/dd/yy", "dd/MM/yy", or any other format that adheres to
         <a href="http://java.sun.com/products/jdk/1.2/docs/api/index.html">java.text.SimpleDateFormat</a>.
         The default is "MM/dd/yy".</td>
      <td valign="top" align="center">No</td>
  </tr>

</table>

<h4>Example</h4>

<PRE>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset lastbuild=&quot;${lastGoodBuildTime}&quot;
        quietperiod=&quot;30&quot;
        dateformat=&quot;yyyy-MMM-dd HH:mm:ss&quot;&gt;

        &lt;vsselement ssdir=&quot;$/Project/src&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.src&quot;
            propertyondelete=&quot;modificationset.src.delete&quot;/&gt;
        &lt;vsselement ssdir=&quot;$/Project/jsp&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.jsp&quot;
            propertyondelete=&quot;modificationset.jsp.delete&quot;/&gt;
        &lt;vsselement ssdir=&quot;$/Project/lib&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.lib&quot;
            propertyondelete=&quot;modificationset.lib.delete&quot;/&gt;
    &lt;/modificationset&gt;
&lt;/target&gt;
</PRE>

This example will recursively scan 3 different folders in sourcesafe, and conditionally set the
properties named in each element.  Thus, I can call a "clean" target for each of these folders and,
using the "depends" attribute, determine whether I need to clean.  The same applies for a target to
get the latest source.  If no modifications have occurred within my src directory, but we've modified
a JSP file, we really don't need to compile all our source again, just repackage our distributable.
</body>

<a name="vssjournalelement"></a>
<h3>VssJournalElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process. The two
property attributes are meant to provide the rest of the ant script with a means to conditionally
build targets based on what was actually modified.  See the examples below for more details.  
</p>
<p>Using this requires that the SourceSafe administrator has turned on journal files.
See the <a href="http://msdn.microsoft.com/library/default.asp?url=/library/en-us/ssusexp98/html/idd_adm_tab_general.asp">
Source Safe documentation</a> for information on how to do this.
</p>

<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">ssdir</td>
    <td valign="top">The SourceSafe directory that you would like to recursively scan for
    modifications.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
      <td valign="top">journalfile</td>
          <td valign="top">Full path to the SourceSafe journal file.</td>
      <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">property</td>
        <td valign="top">Sets the given property to "true" if any modifications have occurred within
        this sourcesafe folder or any child folders recursively.</td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
      <td valign="top">propertyondelete</td>
          <td valign="top">Sets the given property to "true" if any deletes have occurred within
        this sourcesafe folder or any child folders recursively.</td>
      <td valign="top" align="center">No</td>
  </tr>

</table>

<h4>Example</h4>

<PRE>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset lastbuild=&quot;${lastGoodBuildTime}&quot;
        quietperiod=&quot;30&quot;
        dateformat=&quot;yyyy-MMM-dd HH:mm:ss&quot;&gt;

        &lt;vssjournalelement ssdir=&quot;$/Project/src&quot;
            journalfile=&quotj:/VssDir/vss-journal-file.txt&quot;
            property=&quot;modificationset.src&quot;
            propertyondelete=&quot;modificationset.src.delete&quot;/&gt;
        &lt;vssjournalelement ssdir=&quot;$/Project/jsp&quot;
            journalfile=&quotj:/VssDir/vss-journal-file.txt&quot;
            property=&quot;modificationset.jsp&quot;
            propertyondelete=&quot;modificationset.jsp.delete&quot;/&gt;
        &lt;vssjournalelement ssdir=&quot;$/Project/lib&quot;
            journalfile=&quotj:/VssDir/vss-journal-file.txt&quot;
            property=&quot;modificationset.lib&quot;
            propertyondelete=&quot;modificationset.lib.delete&quot;/&gt;
    &lt;/modificationset&gt;
&lt;/target&gt;
</PRE>

<p>This example will recursively scan the journal file located at <code>j:\VssDir\vss-jounral-file.txt</code>
for changes made in three different folders in sourcesafe and conditionally set the
properties named in each element.  Thus, I can call a "clean" target for each of these folders and,
using the "depends" attribute, determine whether I need to clean.  The same applies for a target to
get the latest source.  If no modifications have occurred within my src directory, but we've modified
a JSP file, we really don't need to compile all our source again, just repackage our distributable.
</p>

<h2><a name="starteamcheckout">StarTeamCheckout</a></h2>
<p>This task logs into StarTeam checks out any changes that have occurred since the last successful build. It also creates all working directories on the local directory if appropriate.</p>

<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">folder</td>
    <td valign="top">The StarTeam folder</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">starteamurl</td>
        <td valign="top">The url to the StarTeam server in the form "servername:portnum/project/view"</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">username</td>
    <td valign="top">The username to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">password</td>
    <td valign="top">The password to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">createworkingdirectories</td>
    <td valign="top">"yes" or "true" will create working copy folders that don't already exist</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

<h2><a name="starteamlabel">StarTeamLabel</a></h2>
<p>This task logs into StarTeam and creates a label for the repository at the time of the last successful build.</p>

<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">lastbuild</td>
    <td valign="top">Should be ${lastGoodBuildTime}</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">description</td>
        <td valign="top">Description of successful builds</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">username</td>
    <td valign="top">The username to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">password</td>
    <td valign="top">The password to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">starteamurl</td>
        <td valign="top">The url to the StarTeam server in the form "servername:portnum/project/view"</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

</html>
