<html>
<head>
    <title>CruiseControl Ant Tasks User Manual</title>
</head>

<body>

<h1>CruiseControl Ant Tasks User Manual</h1>
<p>by</p>
<!-- Names are in alphabetical order, on last name -->
<ul>
  <li>Alden Almagro (<a href="mailto:alden@thoughtworks.com">alden@thoughtworks.com</a>)</li>
  <li>Paul Julius (<a href="mailto:pdjulius@thoughtworks.com">pdjulius@thoughtworks.com</a>)</li>
</ul>

<p>Version 1.0 - 2001/04/04</p>
<hr>
<h2>Table of Contents</h2>
<ul>
  <li><a href="#modificationset">ModificationSet</a></li>
  <li><a href="#cvselement">CvsElement</a></li>
  <li><a href="#starteamelement">StarTeamElement</a></li>
  <li><a href="#vsselement">VssElement</a></li>
</ul>


<h2><a name="modificationset">ModificationSet</a></h2>

<h3>Description</h3>

<p>
Controls a build process by terminating a build if no modifications have been
made. This element must include subelements designed to provide a list of
modifications, such as CVSElement.
</p>
<p>
To use this task in an Ant build script the following line will need to be included so that Ant will
know where to find the task:
<pre>
   &lt;taskdef name="modificationset" classname="net.sourceforge.cruisecontrol.ModificationSet" /&gt;
</pre>
</p>
<p>
NOTE: The property <code>modificationset.file</code> is required by
ModificationSet. The value provided will be used to determine the filename for
writing modifications. See examples below.
</p>

<h4>Parameters</h4>

<table border="1" cellspacing="0" cellpadding="0">
    <tr>
        <td valign="top"><b>Attribute</b></td>
        <td valign="top"><b>Description</b></td>
        <td valign="top"><b>Required</b></td>
    </tr>

    <tr>
        <td valign="top">lastbuild</td>
        <td valign="top">The time the last build occured. When used in conjuction with
        the MasterBuild class this should be set to the property   <code>${lastGoodBuildTime}</code></td>
        <td valign="top">Yes</td>
    </tr>

    <tr>
        <td valign="top">quietperiod</td>
        <td valign="top">The number of seconds that must expire after the last
        repository change before a build will commence. Set this value to allow
        developers enough time to commit all their changes to the repository. This stops
        a build from commencing while a developer is in the middle of their commit
        process.</td>

        <td valign="top">Yes</td>
    </tr>

    <tr>
        <td valign="top">dateformat</td>
        <td valign="top">Date formatting pattern which conforms to those recognized by
            <A HREF='http://java.sun.com/j2se/1.3/docs/api/java/text/SimpleDateFormat.html'><CODE>java.text.SimpleDateFormat</CODE></A>.
            If none is provided, then the default date format will be used,
            <CODE>MM-dd-yyyy HH:mm:ss</CODE>. Dates will be displayed in the timezone
            of the current Locale.</td>

        <td valign="top">No</td>
    </tr>
</table>

<h3>Vendor-specific source control elements</h3>

Each vendor-specific nested element controls the interface specifc to its source-control tool.

<a name="cvselement"></a>
<h3>CvsElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process.</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">cvsroot</td>
    <td valign="top">The CVSROOT required to communicate with the CVS repository.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">localworkingcopy</td>
        <td valign="top">This should be the path to the root of the CVS project client copy (i.e., the local working copy)</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>

<a name="vsselement"></a>
<h3>VssElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process. The two
property attributes are meant to provide the rest of the ant script with a means to conditionally
build targets based on what was actually modified.  See the examples below for more detail.  I've
found that it's quicker to log if a delete has occurred within vsselement, clean out all the source
using Ant, and reget all the source rather than using sourcesafe to try to sync itself up with the
local drive.  That's the rationale behind having the propertyondelete attribute.

</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">ssdir</td>
    <td valign="top">The sourcesafe directory that you would like to recursively scan for
    modifications.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
      <td valign="top">login</td>
          <td valign="top">login,password for sourcesafe.</td>
      <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">property</td>
        <td valign="top">Set the given property to "true" if any modifications have occurred within
        this sourcesafe folder or any child folders recursively.</td>
    <td valign="top" align="center">No</td>
  </tr>
  <tr>
      <td valign="top">propertyondelete</td>
          <td valign="top">Set the given property to "true" if any deletes have occurred within
        this sourcesafe folder or any child folders recursively.</td>
      <td valign="top" align="center">No</td>
  </tr>

</table>

<a name="starteamelement"></a>
<h3>StarTeamElement</h3>

<p>Returns a list of modifications found in the repository between two dates. This element
is meant to be used in conjuction with a ModificationSet to control a build process.  NOTE: this
class is not currently distributed with cruisecontrol.jar as it requires a proprietary 3rd party
library.
</p>
<h4>Parameters</h4>
<table border="1" cellpadding="2" cellspacing="0">
  <tr>
    <td valign="top"><b>Attribute</b></td>
    <td valign="top"><b>Description</b></td>
    <td align="center" valign="top"><b>Required</b></td>
  </tr>
  <tr>
    <td valign="top">folder</td>
    <td valign="top">The StarTeam folder to recursively scan for modifications.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">starteamurl</td>
        <td valign="top">The url to the StarTeam server</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">username</td>
    <td valign="top">The username to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
  <tr>
    <td valign="top">password</td>
    <td valign="top">The password to connect as.</td>
    <td valign="top" align="center">Yes</td>
  </tr>
</table>


<h3>Examples</h3>
<PRE>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset lastbuild=&quot;${lastGoodBuildTime}&quot;
        quietperiod=&quot;30&quot;
        dateformat=&quot;yyyy-MMM-dd HH:mm:ss&quot;&gt;

        &lt;cvselement cvsroot=&quot;:pserver:anoncvs@jakarta.apache.org:/home/cvspublic&quot;
            localworkingcopy=&quot;src\mymodule&quot;/&gt;
    &lt;/modificationset&gt;
&lt;/target&gt;
</PRE>


<PRE>
&lt;target name=&quot;modificationset&quot;&gt;
    &lt;modificationset lastbuild=&quot;${lastGoodBuildTime}&quot;
        quietperiod=&quot;30&quot;
        dateformat=&quot;yyyy-MMM-dd HH:mm:ss&quot;&gt;

        &lt;vsselement ssdir=&quot;$/Project/src&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.src&quot;
            propertyondelete=&quot;modificationset.src.delete&quot;/&gt;
        &lt;vsselement ssdir=&quot;$/Project/jsp&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.jsp&quot;
            propertyondelete=&quot;modificationset.jsp.delete&quot;/&gt;
        &lt;vsselement ssdir=&quot;$/Project/lib&quot;
            login=&quot;mylogin,mypassword&quot;
            property=&quot;modificationset.lib&quot;
            propertyondelete=&quot;modificationset.lib.delete&quot;/&gt;
    &lt;/modificationset&gt;
&lt;/target&gt;
</PRE>

This example will recursively scan 3 different folders in sourcesafe, and conditionally set the
properties named in each element.  Thus, I can call a "clean" target for each of these folders and,
using the "depends" attribute, determine whether I need to clean.  The same applies for a target to
get the latest source.  If no modifications have occurred within my src directory, but we've modified
a JSP file, we really don't need to compile all our source again, just repackage our distributable.
</body>

</html>
