<html>

<head>
<title>CruiseControl v.2 Control Flow</title>
</head>

<body>
<p>
This document describes the flow of control and major elements in version 2 of CruiseControl. See the <a href="#example">example</a> at the bottom for the actual layout of these elements.
<p>
<b>Major Elements</b>
<ul>
	<li> <a href="#cruisecontroller">CruiseController</a> - <i>Controls the continuous integration loop</i>
	<ul>
		<li> Plugin [*] - <i>Defines a user-defined plugin to be used by CruiseControl.</i>
		<li> <a href="#project">Project</a> [+] - <i>Defines a single logical project consisting of source code that needs to be built.</i>
		<ul>
			<li> <a href="#builder">Builder</a> [+] - <i>Defines a build sequence.</i> 
			<li> <a href="#scm">Source Control</a> [+] - <i>Defines a source control element which will be asked if any modifications have occured.</i>
			<li> <a href="#publisher">Publisher </a>[*] - <i>Defines an element which will handle "publishing" information.</i>
		</ul>
		<li><a href="#schedule">Schedule</a> [+] - <i>Defines a schedule for determining when and which builds should occur.</i>
		<ul>
			<li> <a href="#timer">Timer</a> [+] - <i>Defines an element which determines whether or not a build should occur at the current time.</i>
			<li> <a href="#chooser">Chooser</a> [*] - <i>If a build should occur now, Choosers determine which builder in the project to call.</i>
		</ul>
	</ul>
</ul>

<p>
<b><a name="cruisecontroller">CruiseController</a></b><br>
CruiseController runs in a continuous loop, waking up at regular intervals, like every 100 milliseconds. Upon waking up, CruiseController asks all of its Schedules whether or not a build should occur. For each project that should be built now, CruiseController asks the Project to run, telling it which Builder the Schedule said to execute. Once all the Projects have had an opportunity to execute, CruiseController rests again.

<p>
<b><a name="project">Project</a></b><br>
When CruiseController asks a Project to execute the Project must perform several tasks. First the Project asks each of its Source Control elements if they have noticed any modifications. If any of them report that modifications have occured, the Project invokes the Builder specified by the CruiseController. If CruiseController didn't specify any builder, then the "default" builder executes. Once the Builder has completed, the Project provides the results to each of the Publishers, if any, in turn.

<p>
<b><a name="builder">Builders</a></b><br>
One or more Builders may be defined within a Project. A builder defines a complete build process. When using the Ant builder, the builder must include all the information required to send to Ant, including which target to call. One, and only one, Builder in the Project must be specified as the default.

<p>
<b><a name="scm">Source Control</a></b><br>
A Project contains one or more SourceControl elements. A SouceControl element contains the necessary information to determine whether or not changes have been committed to a source control mechanism. These elements are practically identical to SourceControlElements in previous versions of CruiseControl. However, ModificationSet, which SourceControlElements used to be nested inside of, is not required in version 2 of CruiseControl. The Project acts to ask several SourceControl elements whether or not changes have occured.

<p>
<b><a name="publisher">Publishers</a></b><br>
The Project provides all the relevant information from the build process to Publishers. Zero or more of them may be defined for a Project. Each Publisher is free to do as it pleases with the information. A Publisher may wish to simplify the data and write it to a log directory for use by the CruiseControl results web application. Another Publisher may wish to email everyone involved in making changes included in the build.

<p>
<b><a name="schedule">Schedule</a></b><br>
A Schedule controls when Projects are executed. A Project may have one or more Schedules defined for it. When CruiseController asks the Schedules if a build should be performed, it only needs one Schedule to say yes. Schedules need to be defined so that they don't override each other, except when appropriate.

<p>
<b><a name="timer">Timer</a></b><br>
Timers determine whether or not a build should occur at the time they are being asked. Timers might use information like when the last build attempt occured, when the last successful build occured, or simply the current time. The Timer interface defines that a Timer, when asked whether or not a build attempt should be made, may return "Yes", "No", or "Don't Care". The encapsulating Schedule asks every Timer what they think. The Schedule looks for at least one Timer to say "Yes", but none of them to say "No". If any of them say "No", then a build should not occur. If at least one of them says "Yes" and none say "No", then a build should be attempted. If all of them say "Don't Care", then a build attempt should not occur.

<p>
<b><a name="chooser">Chooser</a></b><br>
Choosers determine which Builder from a Project should be called. The Schedule asks each Chooser, in order, whether or not it applies to the current set of circumstances. This decision may be based on the number of builds which have occured, the current time, etc. The first Chooser that applies to the current set of circumstances wins. That Chooser decides which Builder to tell the Project to call.

<p>
<b><a name="example">Example</a></b>
<pre>
&lt;cruisecontrol name="MyFirstCruiseControl"&gt;

    &lt;project name="main.project" build-info-file="main.project.info"&gt;
        &lt;ant name="clean" buildfile="build.xml" target="clean"/&gt;
        &lt;ant name="all" buildfile="main/build.xml" target="all" default="yes"/&gt;
        &lt;cvs root=":pserver:anonymous@jakarta.apache.org:/projects/jakarta/ant" tag="HEAD"
            local="d:/projects/jakarta/ant"/&gt;
        &lt;email mailhost="myhost.smtp.com"/&gt;
    &lt;/project&gt;

    &lt;!-- Perform a clean build every afternoon. --&gt;
    &lt;schedule project="main.project"&gt;
        &lt;always time="12:05PM"/&gt;
        &lt;multiple buildcount="1" builder="clean"/&gt;
    &lt;/schedule&gt;

    &lt;schedule project="main.project"&gt;
        &lt;interval minutes="5"/&gt;
        &lt;pause starttime="11:59 PM" endtime="04:30 AM"/&gt;
        &lt;pause startday="Saturday" endday="Monday"/&gt;
        &lt;multiple buildcount="10" builder="clean"/&gt;
        &lt;multiple buildcount="1" builder="all"/&gt;
    &lt;/schedule&gt;
&lt;/cruisecontrol&gt;
</pre>

</body>

</html>
